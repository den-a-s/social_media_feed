<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MАТ F*CK</title>
    <link rel="stylesheet" type="text/css" href="resources\css\user.css" />
    <link rel="icon" type="image/x-icon" href="resources/favicon.ico" />
  </head>

  <body>
    <div class="container">
      <div class="middle-bar">
        <h2 class="name-of-public">MАТ F*CK</h2>
        <div class="bar">
          <div class="elem">
            <img src="resources\mathboss.jpg" alt="" />
          </div>
          <div class="elem">
            <div class="description">
              <h2><q class="centered">&nbsp;</q></h2>
              <blockquote>
                Значение A называется пределом (предельным значением) функции
                f(x) в точке x0, если для любого наперёд взятого положительного
                числа ε найдётся отвечающее ему положительное число δ = δ(ε)
                такое, что для всех аргументов x, удовлетворяющих условию 0 < |x
                − x0| < δ, выполняется неравенство: |f(x) − A| < ε
              </blockquote>
              <br />
              (c) mathboss
            </div>
          </div>
        </div>
      </div>

      <div class="middle-bar-options">
        <div class="for-crud">
          <div><a href="/createPost">Создать</a></div>
          <div><a href="#">Выйти</a></div>
        </div>
      </div>

      <div class="middle-bar">
        <div class="posts"><b>Посты сообщества</b></div>
      </div>
      {{range .PostsWithLike}}
      <div class="for-post">
        <div class="post">
          <div class="text">
            {{if .Content.Valid}}{{.Content.String}}{{end}}
          </div>
          <img src="{{.ImagePath}}" alt="" />
          <div class="for-buttons">
            <button
              class="heart-button {{if .LikeId.Valid}}active{{end}}"
              {{if.LikeId.Valid}}id="like-{{.LikeId.Int64}}"
              {{end}}
            >
              &#10084;
            </button>
            <button class="delete-button">&#x1F5D1;</button>
          </div>
        </div>
      </div>
      {{end}}
    </div>

    <script>
      // TODO Переписать когда будут состояния лайка в базе
      // Получаем все посты
      const posts = document.querySelectorAll(".for-post")

      posts.forEach((post) => {
        const heartButton = post.querySelector(".heart-button")
        const deleteButton = post.querySelector(".delete-button")
        const post_id = post.id.slice(5)
        const like_id = heartButton.id.slice(5)

        // Формируем URL для запроса
      const url = `/changingLike?post_id=${encodeURIComponent(
        post_id
      )}&like_id=${encodeURIComponent(like_id)}`
        heartButton.addEventListener("click", function () {
          // Выполняем HTTP-запрос
        fetch(url, { method: "POST" })
          .then((response) => {
            if (response.ok) {
              return response.text()
            } else {
              throw new Error("Ошибка смены лайка")
            }
          })
          .catch((error) => {
            // Обработка ошибки
            console.error("Ошибка:", error)
            alert("Не удалось поменять лайк")
          })
          // Если лайк активен, убираем его активное состояние
          if (heartButton.classList.contains("active")) {
            heartButton.classList.remove("active")
          } else {
            heartButton.classList.toggle("active")
          }
        })

        deleteButton.addEventListener("click", function () {
          // Если сердце активно, убираем его активное состояние
          if (deleteButton.classList.contains("active")) {
            deleteButton.classList.remove("active")
          } else {
            deleteButton.classList.toggle("active")
          }
        })
      })
    </script>
  </body>
</html>
